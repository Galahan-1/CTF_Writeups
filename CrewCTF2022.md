# CrewCTF 2022 

In this post I will give you the solutions for some of the challenges I solve during the 2-day ctf

## I. The Huge e

### 1.Description
We were given a python script as follows:
```
from Crypto.Util.number import getPrime, bytes_to_long, inverse, isPrime
from secret import flag

m = bytes_to_long(flag)

def getSpecialPrime():
    a = 2
    for i in range(40):
        a*=getPrime(20)
    while True:
        b = getPrime(20)
        if isPrime(a*b+1):
            return a*b+1


p = getSpecialPrime()
e1 = getPrime(128)
e2 = getPrime(128)
e3 = getPrime(128)

e = pow(e1,pow(e2,e3))
c = pow(m,e,p)

assert pow(c,inverse(e,p-1),p) == m

print(f'p = {p}')
print(f'e1 = {e1}')
print(f'e2 = {e2}')
print(f'e3 = {e3}')
print(f'c = {c}')
```
And also we were given the output of the script: 
```
p = 127557933868274766492781168166651795645253551106939814103375361345423596703884421796150924794852741931334746816404778765897684777811408386179315837751682393250322682273488477810275794941270780027115435485813413822503016999058941190903932883823
e1 = 219560036291700924162367491740680392841
e2 = 325829142086458078752836113369745585569
e3 = 237262361171684477270779152881433264701
c = 962976093858853504877937799237367527464560456536071770645193845048591657714868645727169308285896910567283470660044952959089092802768837038911347652160892917850466319249036343642773207046774240176141525105555149800395040339351956120433647613
```
### 2.Analyze:
Looking at the script, we can go to some conclusions:
> *e* = *e1* ^ ( *e2* ^ *e3*)

> *p* - 1 (or Φ(p)) will be easy to factorize since its prime factor is at most 2 ^ 20, so we can easily use sage or *alpertron.com.ar* to factor it, so calculate Φ(p - 1)
>  will also be easy 

> *c* = *m* ^ (*e1* ^ (*e2* ^ *e3*)). Thus we can calculate the inverse of *e1* ^ (*e2* ^ *e3*) modulo Φ(p) so that we can retrieve the cipher text by calculate the 
> remain of e2 ^ e3 modulo Φ(p - 1)
### 3. Solution:
```from Crypto.Util.number import *
from sympy.ntheory.factor_ import totient

p = 127557933868274766492781168166651795645253551106939814103375361345423596703884421796150924794852741931334746816404778765897684777811408386179315837751682393250322682273488477810275794941270780027115435485813413822503016999058941190903932883823

c = 962976093858853504877937799237367527464560456536071770645193845048591657714868645727169308285896910567283470660044952959089092802768837038911347652160892917850466319249036343642773207046774240176141525105555149800395040339351956120433647613

e1 = 219560036291700924162367491740680392841
e2 = 325829142086458078752836113369745585569
e3 = 237262361171684477270779152881433264701

phi = p - 1

k = power(e2, e3, totient(phi))

reverse = power(e1, k, phi)

inverse_of_e = inverse(reverse, p - 1)

m = power(c, inverse_of_e, p)
print(long_to_bytes(m))

```
> Flag: *crew{7hi5_1s_4_5ma11er_numb3r_7han_7h3_Gr4ham_numb3r}*

## II. Metal

### 1.Description:
We were given a chal.sage:
```
from Crypto.PublicKey import RSA
from Crypto.Util.number import bytes_to_long
import random
import binascii
from secret import flag

e = 3
BITSIZE =  8192
key = RSA.generate(BITSIZE)
n = key.n
flag = bytes_to_long(flag)
m = 510 #floor(BITSIZE/(e*e)) - 400
assert (m < BITSIZE - len(bin(flag)[2:]))
r1 = random.randint(1,pow(2,m))
r2 = random.randint(r1,pow(2,m))
msg1 = pow(2,m)*flag + r1
msg2 = pow(2,m)*flag + r2
C1 = Integer(pow(msg1,e,n))
C2 = Integer(pow(msg2,e,n))
print(f'{n = }\n{C1 = }\n{C2 = }')
```
And the output of the script:
```
n = 823652328526060931201375649241006048943627312591742662481083103378002522077877852124731191042617160616707714556599692967069663667698601996983528940331840856212083763983210643933408040552418340463683380557808507002495230815546453104038740886365473259236836768987811419579308089803722619415774848441151249684528573808701348303730672001325400435253430057941264536553439343549378798471521843765967413899839467956313753964739101523564712402586172009670872793597148015854112713073516537134244622001863136944934492241145306737850771111625635504275979597201321615004183224138178242850606020061860874365891414739635021953470569531263648279914661978749409495850032838932287660547294983608500552408270453150111004704982673000064474229357303826290412232101668643442191345117752836713723186345029858940323602239828980619674790421554523298312252632246856653570861376722546483845572057592874642653507921669598604980999675710944351125800581153679737947035951167396427406664211538456926422574733908468243848301080202616710219948021550303624199272309262465841979895988543037749409344273271528685813232663250051559875409936374630801262025889212026998068310718442102601557388789291924368011403387710015947533663816312246609754580679612583443687679604653697210741383870120265666560114312552082718765229857906075466911647146394186461224534740685587572846934610230530077015354170886197688407248753878297395666994564903309464938353409270895657559261894379593177576322878056778321362020242262629594237747578073010697822390042229221755183530894661801846645578606229378188194698297341498164221255458973569036112042793665638020083355322818801649079577206155596664351547761867936241825962264402061264130743855926770190009644935373522637016531313612905118696369479379392748765790270985780979092810127202612369788297683386941277137962371308477169065442960974519121200614968578299255908217109555425373639991249942561881066593925137769635916819686179968920303847549317832449280869569173490086055713440659573036379376871313591502012736961740953226823792006776306025493582816361497869257717651668075570919074032100188984609089237083774415809378590512597855039607625398955711313352280354581208986236739705133090250836743923077744209886105632205516098409509945870967048379575392597005574605671295696290105152505109115729545462303929321064678575733744453013844396847747874774560936394947704938716022268449263762808882912779863563062087323815155503567025604594567944510834845389179609006394130719657363087
C1 = 138604270237134534112743212644616449187692378939637896055320936677529897960835117799077267347298678107031857708834234867949004008866584408288272718174944005247281182704110071985982762860316789278723189738430436690943806868878982562799129736576593875631850056775539229239799682738700710216806174002449616599477466210310386600736499714740361747969973718347095697189605303148613119104798603461313289164107162759182110107568729898709265252329895862170091572165860623096748730108315029720395180483240857815537765987240293780559413621634616731611457999105645890254616180108684484111551400204145466579713376335168837095473428132610657311922576659063964864816927637794472255883920363962994040086056352213615355155336047742875321877777043584327913192448537029767660816802421871457551873100279391823455263903450304034557919732645143487533538943198997776987742643929566403463889152262047049873409325737357390275038091407938919150758822963329761264354005399142689352595527066743969291045496548965996410916410974600827179080229802502026992567559903302198282019316525974045236753071662259094177004561587843521123352176047829889922474932560434065169177898287264496750729243672
C2 = 138604270237134534112743212644616449187692378939637896055320936677529897960835117799077267347298678107031857708834234867949004008866584408288272718174944005247281182704110071985982762860316789278723189738430436690943806868878982562801315565156426103645734001592666235894224346424366448014174339619953344112868374944069699668659552171905796026764359565068714399719527680623357405851675409955573477228301886561411896147227291350808930951282598922176120977605666135963906053158934308125639347521515926780372069545707019601637468577493997742590807146827349865640857651027809446746299962731018358206171079317925725680542147150070051957133849278906576405074966481232057919403951090124732230438431203080079109828298282999845576767904877434936923847105040157703725014937676457110907557409863930279230474134789746314617582331031090955073528453085567165286271224442421785911327002274933133905582320854345262688022854226418394665705506630780960278867388105443056536999414456768050350078505683642885335398895190922264436040594316438930099159076822113725497974332635130516805301785291427363314598707750026963533325470071715793252887081074252099626695293515248472454824781000
```
## 2.Solution:
This challenge is dumb. One line solution: 
> int(floor(C1**(1/3)) >> m).to_bytes(100, 'big')

And then we got the flag:
> *crew{l00ks_l1k3_y0u_h4v3_you_He4rd_0f_c0pp3rsm1th_sh0r+_p4d_4tt4ck_th4t_w45n't_d1ff1cult_w4s_it?}*

## III. toydl

### 1.Description:
We were given a server to connect to (which unfortunately I forget to save ;-;) and some output were given to us. After received the output, I paste it into a text file 
and modify it a little bit for easier observation:
```
n: 369520637995317866367336688225182965061898803879373674073832046072914710171302486913303917853881549637806426191970292829598855375370563396182543413674021955181862907847280705741114636854238746612618069619482248639049407507041667720977392421249242597197448360531895206645794505182208390084734779667749657408715621

Here is RSA encrypted flag.(e=65537)
126320440623005854600875138383574675205775249948531101442259348096473270903085503792310964778976002717170117485096283834594911249693254644410952505578884772908423544653827222352684620165600903672823979287821306177661121885573748497025710804942004840190171016379925700142336686703381183971666833002154725231219230

Let's see a property of numbers... I like small numbers.

pow(2, x, n) = 6
x->21606807968454766520529084107175158062623274703294799705984925156349373997035743632649715867216648159433730630939058861636582120303338699113498645592338621228070481894445156769437351313971471061779425442129487317917630554305634797690296919992201174927956121524640438775183413288101169580705360562693274958339417

pow(2, x, n) = 9
x->43213615936909533041058168214350316125246549406589599411969850312698747994071487265299431734433296318867461261878117723273164240606677398226997291184677242456140963788890313538874702627942942123558850884258974635835261108611269595380593839984402349855912243049280877550366826576202339161410721125386549916678832

pow(2, x, n) = 3
x->21606807968454766520529084107175158062623274703294799705984925156349373997035743632649715867216648159433730630939058861636582120303338699113498645592338621228070481894445156769437351313971471061779425442129487317917630554305634797690296919992201174927956121524640438775183413288101169580705360562693274958339416

pow(4, x, n) = 9
x->21606807968454766520529084107175158062623274703294799705984925156349373997035743632649715867216648159433730630939058861636582120303338699113498645592338621228070481894445156769437351313971471061779425442129487317917630554305634797690296919992201174927956121524640438775183413288101169580705360562693274958339416

pow(4, x, n) = 3
x->10803403984227383260264542053587579031311637351647399852992462578174686998517871816324857933608324079716865315469529430818291060151669349556749322796169310614035240947222578384718675656985735530889712721064743658958815277152817398845148459996100587463978060762320219387591706644050584790352680281346637479169708

pow(8, x, n) = 9
x->14404538645636511013686056071450105375082183135529866470656616770899582664690495755099810578144432106289153753959372574424388080202225799408999097061559080818713654596296771179624900875980980707852950294752991545278420369537089865126864613328134116618637414349760292516788942192067446387136907041795516638892944

pow(8, x, n) = 3
x->7202269322818255506843028035725052687541091567764933235328308385449791332345247877549905289072216053144576876979686287212194040101112899704499548530779540409356827298148385589812450437990490353926475147376495772639210184768544932563432306664067058309318707174880146258394471096033723193568453520897758319446472

pow(8, x, n) = 6
x->68789042322037899901399142739922213531190892214327212247633649397602243027562329029767224931385807659445647908974735092145336602662873465734923450809783198772444106655438821950560058413359621316189435942839212247873870560114926459781136160541556773230183543715576244986800296759341282346581691226676298068904581

pow(8, x, n) = 4
x->123173545998439288789112229408394321687299601293124558024610682024304903390434162304434639284627183212602142063990097609866285125123521132060847804558007316726174558714580872721495215950738261924525921590925432950469320750692763054435407707754979429841729673081392197456811651326615118306026475411557079498916218

pow(5, x, n) = 4
x->101651508435846472131121026992982127175369332865677196032272241712711171024515826370577416844824734811581351106736224929238579734879671732717639124571916168742336862493284572465162318403582113621582374924091725060981390318743531229548188092491836655143124663368239422819562367919547196053790207486164506763679128

pow(5, x, n) = 9
x->159624441075769368394142197503800917105605266793330527400563601282696932962732683048452274321445695181246055818189076528484173940458256745774766217433996778905066039826859919029954611118842967545793750205189398662362981005947945407568116603784658538931110792205205160154125544664182868277733116044735541284338342

pow(5, x, n) = 3
x->172192380036714150788905270808196199818277334366508682218739812159577144024191963252552116624193235000074634457087111471641800814071769221933018962135503876997163938949365614056098717522475180216291316295788774044033481065993544994610614082708563841846852650913646728169671510827052772868386414581035580266356334

pow(6, x, n) = 9
x->141997416965295486849546892322458652502850390670128808480582247784728456230996812361056958004801816363393016360646922983916999235770803618904474553309200419301820603229504955218189709387942156848904968053547462302189568831762401075340100029630332409419313772378068180267756675141584884876543484516408660699471038

pow(6, x, n) = 2
x->21381451016181723167060725895066415014049505634779014278166887625864449427327215547797500461069479227755098367669111715441214225957239039593398576763905277893720617421183176932026557269082618018941957166420343561757206147138371753156505766001068367671640368622010057958730400924168896291248114300463479274451645

pow(6, x, n) = 8
x->64144353048545169501182177685199245042148516904337042834500662877593348281981646643392501383208437683265295103007335146323642677871717118780195730291715833681161852263549530796079671807247854056825871499261030685271618441415115259469517298003205103014921105866030173876191202772506688873744342901390437823354935

pow(6, x, n) = 3
x->163378867981477210016607618217525067516899896304907822758749135410592905658324027908854458465871295591148114728316034699358213461728042658497873130073105697195541220650688132150216266657024774867846925219967805863946774978900772828496605795631400777090954141000078238226487076065753781167791598816872139973922682

pow(6, x, n) = 4
x->42762902032363446334121451790132830028099011269558028556333775251728898854654431095595000922138958455510196735338223430882428451914478079186797153527810555787441234842366353864053114538165236037883914332840687123514412294276743506313011532002136735343280737244020115917460801848337792582496228600926958548903290

pow(7, x, n) = 4
x->146900004342901005519726059203387905743111231159623333298786259340649199259667124880775175860427705602975071010583553281005991812801779033020769274211420710213704563866848310994325033574484679477677016014418321661821714582236428708141287327064859146436371562752616380650770729341741997594308364878898526065859626

pow(7, x, n) = 9
x->156359509651684605051402965560382969488421316701585527115005130492947292379802933549188085059602557600903593831240316597311439285149968787780538126741092612405335349622445040578126369183536683733294143156965518222696624206221060030916594302284630706642066420353822195108928341123726471513256217857861184609387726

pow(7, x, n) = 3
x->170559914324671769117535654836487226009685359320636182075960576764702323732727088502920021993271666209903403463612731506055433486417625242935904916789051793747298593847158174830184596554822038310041512771676833824200302666130102306284852931958549925702330464987955245647072909056824574486147965487598401928881026

pow(3, x, n) = 4
x->6587964114700820556919765038048400658179448299607759154349466412283102033362097696686353381578892511026234931288012065614233226873990290883303423731623625810802523554084331315067600930023844917377393328422432259693180976006565500449079107246029196051674216942297612737477262172450501905146878136219407907046676

pow(9, x, n) = 4
x->3293982057350410278459882519024200329089724149803879577174733206141551016681048848343176690789446255513117465644006032807116613436995145441651711865811812905401261777042165657533800465011922458688696664211216129846590488003282750224539553623014598025837108471148806368738631086225250952573439068109703953523338
```

## 2.Solution:
Looking at the given output, we can see that:
Some of the outputs are just the power of other output like *pow(2, x, n) = 6* and *pow(4, x, n) = 9*. So we should not care about these type of numbers. 
> So what should we care about ?

 Well, I stuck at the code for some time and try to calculate numbers that are completely different from the other numbers like *7* or *5* and *6* and their *remainder* like 
 3 and 9 of 7's
 
The results I got were quite nice:
> For 7 : new_x = *2 * x_of_3 - x_of_9* = *184760318997658933183668344112591482530949401939686837036916023036457355085651243456651958926940774818903213095985146414799427687685281698091271706837010975089261838071871309082242823926107392886788882386388149425703981126039144581653111561632469144762594509622088296185217476989922677459039713117335619248374326*
> Thus pow(7, new_x, n) = 1 

> For 5 : new_x = *2 * x_of_3 - x_of_9* = *184760318997658933183668344112591482530949401939686837036916023036457355085651243456651958926940774818903213095985146414799427687685281698091271706837010975089261838071871309082242823926107392886788882386388149425703981126039144581653111561632469144762594509622088296185217476989922677459039713117335619248374326*
> Thus pow(5, new_x, n) = 1
Huh ? Somehow new_x of 5 and new_x of 7 is equal ? Kinda strange right

Let's try to calculate the same for 6:
> new_x = *2 * x_of_3 - x_of_9* = *184760318997658933183668344112591482530949401939686837036916023036457355085651243456651958926940774818903213095985146414799427687685281698091271706837010975089261838071871309082242823926107392886788882386388149425703981126039144581653111561632469144762594509622088296185217476989922677459039713117335619248374326*
> Thus pow(6, new_x, n) = 1

Wow. We got the same new_x for all three numbers. This is odd since this are 3 consecutive numbers. Here I started to suspect that this *new_x* is  the totient function since the number of digits is equals to the number of digits of n (both has 312 digits).
So I tried to factorize it:
> new_x = 2 * 2857 * 13687 * 17977 * 31663 * 32917 * 58207 * 71569 * 79337 * 83773 * 90971 * 134873 * 154933 * 163127^4 * 164377 * 187189 * 228539 * 230539 * 265129 * 267581 * 267601 * 358327 * 384907 * 409987 * 420361 * 440893 * 447263 * 477523 * 496063 * 505357^3 * 507499 * 541831 * 577427 * 582223 * 593407 * 641881 * 652039 * 689699 * 692387 * 704009 * 712171 * 749851 * 761869 * 765181 * 797281 * 806389 * 829319 * 866279 * 883577 * 919249 * 933403 * 939871 * 969911
But this is kinda wrong since n % 8 == 5 so the totient function of n is divisible by 4 but new_x only divisible by 2. However, I still suspect that this number is only
smaller than Φ(n) only a small number of times.

Start with this thought and the fact that Φ(n) is divisible by 4, I doubled new_x up and try to solve p and q. Luckily, my idea was right and we got p and q:
> p = 4928360825890784253111612236014417888171491818338372279657244977120457455636085693749117643315398585668171611204641939707873722724850993393487100817165978583
> q = 74978405812753834465016752987606072667548486508333670130396468134505922921585475548866660992273673673116107409633419843328640310315661959945977601745988387

From here the flag was retrieved easily.

Full solve script:
```
from Crypto.Util.number import *

def gcd(a, b):
	if b == 0:
		return a
	else:
		return gcd()

def nth_root(x,n):
    """Finds the integer component of the n'th root of x,
    an integer such that y ** n <= x < (y + 1) ** n.
    """
    high = 1
    while high ** n <= x:
        high *= 2
    low = high // 2
    while low < high:
        mid = int((low + high+1)) // 2  
        if low < mid and mid**n < x:
            low = mid
        elif high > mid and mid**n > x:
            high = mid - 1 
        else:
            return mid
    return mid 

n = 369520637995317866367336688225182965061898803879373674073832046072914710171302486913303917853881549637806426191970292829598855375370563396182543413674021955181862907847280705741114636854238746612618069619482248639049407507041667720977392421249242597197448360531895206645794505182208390084734779667749657408715621

e = 65537

c = 126320440623005854600875138383574675205775249948531101442259348096473270903085503792310964778976002717170117485096283834594911249693254644410952505578884772908423544653827222352684620165600903672823979287821306177661121885573748497025710804942004840190171016379925700142336686703381183971666833002154725231219230


x1 = 163378867981477210016607618217525067516899896304907822758749135410592905658324027908854458465871295591148114728316034699358213461728042658497873130073105697195541220650688132150216266657024774867846925219967805863946774978900772828496605795631400777090954141000078238226487076065753781167791598816872139973922682
x2 = 141997416965295486849546892322458652502850390670128808480582247784728456230996812361056958004801816363393016360646922983916999235770803618904474553309200419301820603229504955218189709387942156848904968053547462302189568831762401075340100029630332409419313772378068180267756675141584884876543484516408660699471038

k1 = abs(x2 - x1 * 2)

#print(k1)

x3 = 172192380036714150788905270808196199818277334366508682218739812159577144024191963252552116624193235000074634457087111471641800814071769221933018962135503876997163938949365614056098717522475180216291316295788774044033481065993544994610614082708563841846852650913646728169671510827052772868386414581035580266356334
x4 = 159624441075769368394142197503800917105605266793330527400563601282696932962732683048452274321445695181246055818189076528484173940458256745774766217433996778905066039826859919029954611118842967545793750205189398662362981005947945407568116603784658538931110792205205160154125544664182868277733116044735541284338342

k2 = abs(x3 * 2 -x4)
#print(k2)

s = 184760318997658933183668344112591482530949401939686837036916023036457355085651243456651958926940774818903213095985146414799427687685281698091271706837010975089261838071871309082242823926107392886788882386388149425703981126039144581653111561632469144762594509622088296185217476989922677459039713117335619248374326

#print(pow(5,s,n))
#print(pow(6,s,n))
#print(pow(7,s,n))

phi = n + 1 - 2 * s

summer = phi ** 2 - 4 * n

square = nth_root(summer, 2)

p = (square + phi) // 2
q = phi - p
print("p =", p)
print("q =", q)

output = 2689276504310631707478400123130984936310976782319770622603922543360881069490035758414301813498217745374830369542722941247551735690124561015564676628519906993119832597021135435970751146045680238055519831015820279678694558572703641886454848236967291037462015700658168832646801086807243098003268469538880

print(long_to_bytes(output))
```
> The flag is : *crew{d15cr373_l06_15_r3duc710n_f0r_f4c70r1n6}*



